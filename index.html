<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BASE √ÅREA PRODUCTO</title>

    <link rel="stylesheet" href="styles.css">
    <script defer src="script.js"></script>

    <!-- Exportar -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

<h1>BASE √ÅREA PRODUCTO</h1>

<!-- üî¥ BOT√ìN PARA CARGAR BASE -->
<button id="btn-cargar" onclick="loadDatabase()">‚¨áÔ∏è Cargar Base de Datos</button>
<button class="add-btn" onclick="toggleForm()">‚ûï Agregar registro</button>

<div id="add-form" class="add-form" style="display:none;">
    <input id="f-serie" placeholder="Serie">
    <input id="f-modelo" placeholder="Modelo">
    <input id="f-cliente" placeholder="Cliente">
    <input id="f-ciudad" placeholder="Ciudad">
    <input id="f-area" placeholder="√Årea">
    <input id="f-calidad" placeholder="Calidad equipo">
    <input id="f-venta-fabrica" placeholder="Venta f√°brica">
    <input id="f-instalacion" placeholder="Instalaci√≥n">
    <input id="f-venta-perfectech" placeholder="Venta Perfectech">
    <input id="f-inicio-garantia" placeholder="Inicio garant√≠a">
    <input id="f-termino-garantia" placeholder="T√©rmino garant√≠a">
    <input id="f-ultima-reparacion" placeholder="√öltima reparaci√≥n">
    <input id="f-vendedor" placeholder="Vendedor">
    <input id="f-distribuidor" placeholder="Distribuidor">

    <button type="button" onclick="saveRecord()">üíæ Guardar</button>
</div>

<!-- Descargas -->
<div class="dropdown">
    <button class="dropbtn">‚¨áÔ∏è</button>
    <div class="dropdown-content">
        <a href="#" onclick="downloadExcel()">üìÇ Descargar Excel</a>
    </div>
</div>

<!-- Info -->
<div id="data-info">
    <p><strong>Registros cargados:</strong> <span id="record-count">0</span></p>
</div>

<!-- FILTROS -->
<div class="filters">
    <label>Modelo:
        <select id="filter-modelo" onchange="filterTable()">
            <option value="">Todos</option>
        </select>
    </label>

    <label>Cliente:
        <select id="filter-cliente" onchange="filterTable()">
            <option value="">Todos</option>
        </select>
    </label>

    <label>Ciudad:
        <select id="filter-ciudad" onchange="filterTable()">
            <option value="">Todos</option>
        </select>
    </label>

    <label>√Årea:
        <select id="filter-area" onchange="filterTable()">
            <option value="">Todos</option>
        </select>
    </label>

    <label>Vendedor:
        <select id="filter-vendedor" onchange="filterTable()">
            <option value="">Todos</option>
        </select>
    </label>

    <label>Distribuidor:
        <select id="filter-distribuidor" onchange="filterTable()">
            <option value="">Todos</option>
        </select>
    </label>
</div>

<!-- TABLA -->
<table>
    <thead>
        <tr>
            <th>SERIE</th>
            <th>MODELO</th>
            <th>CLIENTE</th>
            <th>CIUDAD</th>
            <th>√ÅREA</th>
            <th>CALIDAD</th>
            <th>VENTA F√ÅBRICA</th>
            <th>INSTALACI√ìN</th>
            <th>VENTA PERFECTECH</th>
            <th>INICIO GARANT√çA</th>
            <th>FIN GARANT√çA</th>
            <th>√öLTIMA REPARACI√ìN</th>
            <th>VENDEDOR</th>
            <th>DISTRIBUIDOR</th>
            <th>ACCIONES</th>
        </tr>
    </thead>
    <tbody id="table-body"></tbody>
</table>

<!-- üî¥ LOADING -->
<div id="loading" style="
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255,255,255,0.9);
    display: none; /* oculto al inicio */
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: bold;
    z-index: 9999;
">
    ‚è≥ Cargando base de datos...
</div>

<!-- üîΩ SCRIPT -->
<script>
const btnCargar = document.getElementById("btn-cargar");
const loadingDiv = document.getElementById("loading");

function showLoading() {
    loadingDiv.style.display = "flex";
    btnCargar.disabled = true; // Bloqueamos bot√≥n mientras carga
}

function hideLoading() {
    loadingDiv.style.display = "none";
    btnCargar.disabled = false; // Habilitamos bot√≥n
}

function loadDatabase() {
    showLoading();

    // Reemplaza 'datos.json' con tu archivo real
    fetch('datos.json')
        .then(response => response.json())
        .then(data => {
            renderTable(data);
            hideLoading();
        })
        .catch(error => {
            console.error("Error al cargar la base de datos:", error);
            hideLoading();
        });
}

function renderTable(data) {
    const tbody = document.getElementById("table-body");
    tbody.innerHTML = ""; // limpiar tabla

    data.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${item.serie}</td>
            <td>${item.modelo}</td>
            <td>${item.cliente}</td>
            <td>${item.ciudad}</td>
            <td>${item.area}</td>
            <td>${item.calidad}</td>
            <td>${item.venta_fabrica}</td>
            <td>${item.instalacion}</td>
            <td>${item.venta_perfectech}</td>
            <td>${item.inicio_garantia}</td>
            <td>${item.termino_garantia}</td>
            <td>${item.ultima_reparacion}</td>
            <td>${item.vendedor}</td>
            <td>${item.distribuidor}</td>
            <td>‚úèÔ∏èüóëÔ∏è</td>
        `;
        tbody.appendChild(row);
    });

    document.getElementById("record-count").textContent = data.length;
}
</script>

</body>
</html>

